<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=PT+Sans:300,400,500,600" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,500,600" rel="stylesheet">
</head>

<style type="text/css">
    body {
        font-family: 'Roboto', sans-serif;
        font-weight: 430;
    }

    #title {
        font-family: 'Roboto', sans-serif;
        font-size: 42px;
        font-weight: 600;
        color: 111111;
        line-height: 1em;
        margin: 20px;
    }

    #byline {
        font-family: 'Roboto', sans-serif;
        font-size: 16px;
        font-weight: 500;
        line-height: 1em;
        margin: 21px;
        position: absolute;
        top: 135px;
        color: 111111;
    }

    .intro {
        position: absolute;
        text-align: right;
        font-weight: 300;
        color: 111111;
    }

    #intro1 {
        top: 24px;
        left: 640px;
        width: 520px;
    }

    #intro2 {
        top: 44px;
        left: 660px;
        width: 500px;
    }

    #intro3 {
        top: 64px;
        left: 680px;
        width: 480px;
    }

    #intro4 {
        top: 84px;
        left: 700px;
        width: 460px;
    }

    #intro5 {
        top: 104px;
        left: 720px;
        width: 440px;
    }

    #intro6 {
        top: 124px;
        left: 740px;
        width: 420px;
    }

    #intro7 {
        top: 144px;
        left: 760px;
        width: 400px;
    }

    #intro8 {
        top: 164px;
        left: 780px;
        width: 380px;
    }

    #intro9 {
        top: 184px;
        left: 800px;
        width: 360px;
    }

    .fromTo {
        font-family: 'PT Sans', sans-serif;
        position: absolute;
        font-size: 27px;
        color: #333333;
        top: 260px;
        z-index: 1
    }

    #from {
        left: 30px;
    }

    #startYear {
        left: 100px;
    }

    #to {
        left: 850px;
    }

    #endYear {
        left: 885px;
    }

    #source {
        font-family: 'Roboto', sans-serif;
        font-size: 14px;
        color: 111111;
        text-align: left;
        position: absolute;
        top: 930px;
        margin: 20px;
    }

    #plot {
        left: 160px;
        top: 50px;
        text-align: left;
        position: absolute;
        z: 0;
    }

    .axis-title {
        font-family: "PT Sans";
        font-size: 18px;
        fill: #696969;
    }

    .inequality {
        font-family: "PT Sans";
        font-size: 16px;
        fill: #696969;
    }

    .country {
        font-family: "PT Sans";
        pointer-events: none;
        font-size: 18px;
        font-style: bold;
        position: absolute;
        fill: #333333;
    }
    
    .score {
        font-family: "PT Sans";
        pointer-events: none;
        font-size: 16px;
        position: absolute;
        fill: #696969;
    }

    .keyTitle {
        font-family: "PT Sans";
        font-size: 17px;
        fill: #696969;
    }

    .key {
        font-family: "PT Sans";
        font-weight: 300;
        font-size: 14px;
        fill: #696969;
    }

    #diamond {
        -webkit-transform: rotate(-45deg);
    }

    .x-axis .y-axis {
        fill: none;
        stroke: rgb(100, 100, 100);
        shape-rendering: crispEdges;
    }

    .grid line {
        stroke: lightgrey;
        stroke-opacity: 0.4;
        stroke-width: 1;
        shape-rendering: crispEdges;
    }

    .zero-line {
        stroke: grey;
        stroke-opacity: 0.8;
        stroke-width: 1.5;
        stroke-dasharray: 5;
        shape-rendering: crispEdges;
    }

    .hover-line {
        stroke-opacity: 0.5;
        stroke-width: 1;
        shape-rendering: crispEdges;
    }

    .arrow {
        stroke: #A9A9A9;
        stroke-width: 1.5;
        shape-rendering: crispEdges;
    }

    .modal {
        font-family: "PT Sans";
        position: absolute;
        top: 115px;
        left: 291px;
        z-index: 10000;
        overflow: auto;
        overflow-y: auto;
        height: 680px;
        width: 540px;
    }
</style>

<body>

    <h1 id="title">Africa: How has income<br>inequality changed<br>over time?<br></h1>

    <p id="byline">by JULIAN H. LANGE</p>

    <p class="intro" id="intro1">The Gini coefficient is a measure of income inequality. It can change in</p>
    <p class="intro" id="intro2">response to policy, national and world events, and economic factors.</p>
    <p class="intro" id="intro3">This rotated scatterplot displays changes in the coefficient for any</p>
    <p class="intro" id="intro4">two 5-year periods from 1976 to 2015, with a focus on Africa.</p>
    <p class="intro" id="intro5">Countries for which data are available in both selected time</p>
    <p class="intro" id="intro6">periods appear on the plot. Hover and click on any point</p>
    <p class="intro" id="intro7">to view country name, change in Gini score, and more<br></p>
    <p class="intro" id="intro8">data. Navigate <a href="https://github.com/julianhlange/portfolio/blob/master/undp/README.md" target="_blank">here</a> for data sources, project details,</p>
    <p class="intro" id="intro9">and a guide to interpreting the rotated scatterplot.</p>

    <p id="from" class="fromTo">From</p>
    <p id="to" class="fromTo">to</p>

    <p id="source">Data source: <a href="https://data.worldbank.org/data-catalog/world-development-indicators" target="_blank">
        World Bank World Development Indicators</a>, retrieved October 2017<br> Gini ranges: United Nations Development Programme <a href="http://www.africa.undp.org/content/rba/en/home/library/reports/income-inequality-trends-in-sub-saharan-africa--divergence--dete.html"
            target="_blank">Income Inequality Trends in sub-Saharan Africa: Divergence, Determinants, and Consequences</a>, published September 2017<br> Visualization: <a href="https://www.julianhlange.com" target="_blank">Julian H. Lange</a>, December 2017</p>

    <div id="inputForm">
        <form>
            <div class="input">
                <select id="startYear" class="fromTo">
                <option value="_2011_2015">2011–2015</option><option value="_2006_2010">2006–2010</option><option value="_2001_2005">2001–2005</option>
                <option selected value="_1996_2000">1996–2000</option><option value="_1991_1995">1991–1995</option><option value="_1986_1990">1986–1990</option>
                <option value="_1981_1985">1981–1985</option><option value="_1976_1980">1976–1980</option>
            </select>

                <select id="endYear" class="fromTo">
                <option selected value="_2011_2015">2011–2015</option><option value="_2006_2010">2006–2010</option><option value="_2001_2005">2001–2005</option>
                <option value="_1996_2000">1996–2000</option><option value="_1991_1995">1991–1995</option><option value="_1986_1990">1986–1990</option>
                <option value="_1981_1985">1981–1985</option><option value="_1976_1980">1976–1980</option>
            </select>
            </div>
        </form>
    </div>

    <div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="countryName"></h3>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                </div>
            </div>
        </div>
    </div>

    <div id="plot"></div>

    <script>
        draw()

        $("form").on('change', draw);

        function draw(e) {
            e ? e.preventDefault() : null;
            d3.selectAll("svg").remove();
            var xColumn = $("#endYear").val();
            var yColumn = $("#startYear").val();
            var xYearGini = "Income inequality in " + xColumn.substr(1, 4) + "–" + xColumn.substr(6, 4) + " (Gini coefficient)";
            var yYearGini = "Income inequality in " + yColumn.substr(1, 4) + "–" + yColumn.substr(6, 4) + " (Gini coefficient)"

            var pad = 100;
            var w = 800;
            var h = 800;
            var graphTop = h - pad;
            var radius = 8;
            var minGini = 0;
            var maxGini = 80;
            var vlowToLow = 39.95
            var lowToMed = 44.95
            var medToHigh = 52.95
            var highToVhigh = 59.95

            d3.csv("giniDataWorldRanges.csv", function(error, data) {
                if (error) throw error;
                data.forEach(function(d) {
                    d[xColumn] = +d[xColumn];
                    d[yColumn] = +d[yColumn];
                    d["africa"] = d["africa"];
                    d["countryName"] = d["countryName"];
                    d["difference"] = d[xColumn] - d[yColumn];
                    d["difference"] = d["difference"].toFixed(1);
                    if (d["difference"] > 0) { d["countryNameDifference"] = d["countryName"] + " (+" + d["difference"] + ")" }
                    else if (d["difference"] <= 0) { d["countryNameDifference"] = d["countryName"] + " (–" + Math.abs(d["difference"]) + ")" };
                });
                plot(data)
            });

            function plot(data) {
                var svg = d3.select("#plot")
                    .append("svg")
                    .attr("id", "diamond")
                    .attr("height", h)
                    .attr("width", w);

                var xScale = d3.scaleLinear()
                    .domain([minGini, maxGini])
                    .range([pad, w - pad]);

                var yScale = d3.scaleLinear()
                    .domain([minGini, maxGini])
                    .range([h - pad, pad]);

                var cScale = d3.scaleOrdinal()
                    .domain(["no", "yes"])
                    .range(["777777", "orange"]);

                var xAxis = d3.axisBottom(xScale).ticks(8);
                var yAxis = d3.axisLeft(yScale).ticks(8);

                // functions to make gridlines on x and y axes
                function make_x_gridlines() {
                    return d3.axisBottom(xScale)
                        .ticks(8)
                }

                function make_y_gridlines() {
                    return d3.axisLeft(yScale)
                        .ticks(8)
                }

                // blue diamond
                svg.append("rect")
                    .attr("x", pad)
                    .attr("y", pad)
                    .attr("width", w - 2 * pad)
                    .attr("height", h - 2 * pad)
                    .style("fill", '#EAF8FD');

                // color coding on x
                svg.append("rect")
                    .attr("x", pad)
                    .attr("y", h - pad - 10)
                    .attr("width", ((vlowToLow - minGini) / (maxGini - minGini)) * (w - 2 * pad))
                    .attr("height", 10)
                    .style("fill", "4c9f38")
                    .style("opacity", 0.6);

                svg.append("rect")
                    .attr("x", pad + ((vlowToLow - minGini) / (maxGini - minGini)) * (w - 2 * pad))
                    .attr("y", h - pad - 10)
                    .attr("width", ((lowToMed - vlowToLow) / (maxGini - minGini)) * (w - 2 * pad))
                    .attr("height", 10)
                    .style("fill", "002D62")
                    .style("opacity", 0.6);

                svg.append("rect")
                    .attr("x", pad + ((lowToMed - minGini) / (maxGini - minGini)) * (w - 2 * pad))
                    .attr("y", h - pad - 10)
                    .attr("width", ((medToHigh - lowToMed) / (maxGini - minGini)) * (w - 2 * pad))
                    .attr("height", 10)
                    .style("fill", "87499C")
                    .style("opacity", 0.6);

                svg.append("rect")
                    .attr("x", pad + ((medToHigh - minGini) / (maxGini - minGini)) * (w - 2 * pad))
                    .attr("y", h - pad - 10)
                    .attr("width", ((highToVhigh - medToHigh) / (maxGini - minGini)) * (w - 2 * pad))
                    .attr("height", 10)
                    .style("fill", "#dda63a")
                    .style("opacity", 0.6);

                svg.append("rect")
                    .attr("x", pad + ((highToVhigh - minGini) / (maxGini - minGini)) * (w - 2 * pad))
                    .attr("y", h - pad - 10)
                    .attr("width", ((maxGini - highToVhigh) / (maxGini - minGini)) * (w - 2 * pad))
                    .attr("height", 10)
                    .style("fill", "#e5243b")
                    .style("opacity", 0.6);

                // color coding on y
                svg.append("rect")
                    .attr("x", pad)
                    .attr("y", h - pad - ((vlowToLow - minGini) / (maxGini - minGini)) * (h - 2 * pad))
                    .attr("width", 10)
                    .attr("height", ((vlowToLow - minGini) / (maxGini - minGini)) * (h - 2 * pad) - 10) // the minus 10 here is just to avoid overlapping green bars
                    .style("fill", "4c9f38")
                    .style("opacity", 0.6);

                svg.append("rect")
                    .attr("x", pad)
                    .attr("y", h - pad - ((lowToMed - minGini) / (maxGini - minGini)) * (h - 2 * pad))
                    .attr("width", 10)
                    .attr("height", ((lowToMed - vlowToLow) / (maxGini - minGini)) * (h - 2 * pad))
                    .style("fill", "002D62")
                    .style("opacity", 0.6);

                svg.append("rect")
                    .attr("x", pad)
                    .attr("y", h - pad - ((medToHigh - minGini) / (maxGini - minGini)) * (h - 2 * pad))
                    .attr("width", 10)
                    .attr("height", ((medToHigh - lowToMed) / (maxGini - minGini)) * (h - 2 * pad))
                    .style("fill", "87499C")
                    .style("opacity", 0.6);

                svg.append("rect")
                    .attr("x", pad)
                    .attr("y", h - pad - ((highToVhigh - minGini) / (maxGini - minGini)) * (h - 2 * pad))
                    .attr("width", 10)
                    .attr("height", ((highToVhigh - medToHigh) / (maxGini - minGini)) * (h - 2 * pad))
                    .style("fill", "#dda63a")
                    .style("opacity", 0.6);

                svg.append("rect")
                    .attr("x", pad)
                    .attr("y", h - pad - ((maxGini - minGini) / (maxGini - minGini)) * (h - 2 * pad))
                    .attr("width", 10)
                    .attr("height", ((maxGini - highToVhigh) / (maxGini - minGini)) * (h - 2 * pad))
                    .style("fill", "#e5243b")
                    .style("opacity", 0.6);

                // zero line in three sections
                svg.append("line")
                    .attr("class", "zero-line")
                    .attr("x1", pad)
                    .attr("y1", h - pad)
                    .attr("x2", pad + 100)
                    .attr("y2", h - pad - 100);
                svg.append("line")
                    .attr("class", "zero-line")
                    .attr("x1", pad + 115)
                    .attr("y1", h - pad - 115)
                    .attr("x2", w - pad - 115)
                    .attr("y2", pad + 115);
                svg.append("line")
                    .attr("class", "zero-line")
                    .attr("x1", w - pad - 100)
                    .attr("y1", pad + 100)
                    .attr("x2", w - pad)
                    .attr("y2", pad);

                // x axis and label
                svg.append("g")
                    .attr("class", "x-axis")
                    .attr("transform", "translate(0," + (h - pad) + ")")
                    .call(xAxis)
                    .selectAll("text")
                    .style("text-anchor", "start")
                    .attr("dx", 5)
                    .attr("dy", 2)
                    .attr("transform", 'rotate(45)')
                    .attr('text-anchor', 'start');
                d3.select('.x-axis')
                    .append('text')
                    .attr("class", "axis-title")
                    .attr("transform", "translate(" + (w / 2) + ", 40)")
                    .attr('fill', '111111')
                    .attr('text-anchor', 'center')
                    .text(function(d) {
                        return xYearGini;
                    });

                // y axis and label
                svg.append("g")
                    .attr("class", "y-axis")
                    .attr("transform", "translate(" + pad + ", 0)")
                    .call(yAxis)
                    .selectAll("text")
                    .style("text-anchor", "end")
                    .attr("dx", 5)
                    .attr("dy", 10)
                    .attr("transform", 'rotate(45)')
                    .attr('text-anchor', 'end');
                d3.select('.y-axis')
                    .append('text')
                    .attr("class", "axis-title")
                    .attr("transform", "translate (-40," + (h / 2 - 190) + ") rotate(90)")
                    .attr('fill', '111111')
                    .attr('text-anchor', 'start')
                    .text(function(d) {
                        return yYearGini;
                    });

                // x and y grids
                svg.append("g")
                    .attr("class", "grid")
                    .attr("transform", "translate(0," + graphTop + ")")
                    .call(make_x_gridlines()
                        .tickSize(-h + 2 * pad)
                        .tickFormat("")
                    )
                svg.append("g")
                    .attr("class", "grid")
                    .attr("transform", "translate(" + pad + ",0)")
                    .call(make_y_gridlines()
                        .tickSize(-h + 2 * pad)
                        .tickFormat("")
                    )

                // improved and worsened arrows
                svg.append("line")
                    .attr("class", "arrow")
                    .attr("x1", w * 13 / 20).attr("y1", h * 13 / 20).attr("x2", w * 16 / 20).attr("y2", h * 16 / 20);
                svg.append("line")
                    .attr("class", "arrow")
                    .attr("x1", w * 16 / 20).attr("y1", h * 16 / 20).attr("x2", w * 16 / 20).attr("y2", h * 15.5 / 20);
                svg.append("line")
                    .attr("class", "arrow")
                    .attr("x1", w * 15.5 / 20).attr("y1", h * 16 / 20).attr("x2", w * 16 / 20).attr("y2", h * 16 / 20);
                svg.append("line")
                    .attr("class", "arrow")
                    .attr("x1", w * 4 / 20).attr("y1", h * 4 / 20).attr("x2", w * 7 / 20).attr("y2", h * 7 / 20);
                svg.append("line")
                    .attr("class", "arrow")
                    .attr("x1", w * 4 / 20).attr("y1", h * 4 / 20).attr("x2", w * 4 / 20).attr("y2", h * 4.5 / 20);
                svg.append("line")
                    .attr("class", "arrow")
                    .attr("x1", w * 4.5 / 20).attr("y1", h * 4 / 20).attr("x2", w * 4 / 20).attr("y2", h * 4 / 20);

                // high and low Gini arrows
                svg.append("line")
                    .attr("class", "arrow")
                    .attr("x1", w * 15 / 20).attr("y1", h * 5 / 20).attr("x2", w * 16 / 20).attr("y2", h * 4 / 20);
                svg.append("line")
                    .attr("class", "arrow")
                    .attr("x1", w * 15.5 / 20).attr("y1", h * 4 / 20).attr("x2", w * 16 / 20).attr("y2", h * 4 / 20);
                svg.append("line")
                    .attr("class", "arrow")
                    .attr("x1", w * 16 / 20).attr("y1", h * 4 / 20).attr("x2", w * 16 / 20).attr("y2", h * 4.5 / 20);
                svg.append("line")
                    .attr("class", "arrow")
                    .attr("x1", w * 5 / 20).attr("y1", h * 15 / 20).attr("x2", w * 4 / 20).attr("y2", h * 16 / 20);
                svg.append("line")
                    .attr("class", "arrow")
                    .attr("x1", w * 4 / 20).attr("y1", h * 15.5 / 20).attr("x2", w * 4 / 20).attr("y2", h * 16 / 20);
                svg.append("line")
                    .attr("class", "arrow")
                    .attr("x1", w * 4 / 20).attr("y1", h * 16 / 20).attr("x2", w * 4.5 / 20).attr("y2", h * 16 / 20);

                // improved and worsened labels
                svg.append("text")
                    .attr('class', "inequality")
                    .attr("x", w * 6.8 / 20)
                    .attr("y", h * 8.1 / 20)
                    .text("Inequality improved")
                    .attr("transform", 'translate(220,-250) rotate(45)')
                svg.append("text")
                    .attr('class', "inequality")
                    .attr("x", w * 23.3 / 20)
                    .attr("y", h * 8.6 / 20)
                    .text("Inequality worsened")
                    .attr("transform", 'translate(117,-380) rotate(45)')

                // high and low Gini labels
                svg.append("text")
                    .attr('class', "inequality")
                    .attr("x", w * 13.1 / 20)
                    .attr("y", h * 1.6 / 20)
                    .text("Higher inequality")
                    .attr("transform", 'translate(220,-250) rotate(45)')
                svg.append("text")
                    .attr('class', "low inequality")
                    .attr("x", w * 17.3 / 20)
                    .attr("y", h * 15.7 / 20)
                    .text("Lower inequality")
                    .attr("transform", 'translate(117,-380) rotate(45)')

                var circ = svg.selectAll("circle")
                    .data(data)
                    .enter()
                    .append("circle")
                    .attr("class", "dot")
                    .attr("data-toggle", "modal")
                    .attr("data-target", "#myModal")
                    .attr("cx", function(d) { return xScale(d[xColumn]); })
                    .attr("cy", function(d) { return yScale(d[yColumn]); })
                    .attr("r", radius)
                    .attr("opacity", 0.8)
                    .style("fill", function(d) { return cScale(d["africa"]); })

                d3.selectAll('.dot')
                    .on('mouseover', function() {
                        d3.select("svg")
                            .append('line')
                            .attr('class', 'hover-line _temp')
                            .attr('x1', d3.select(this).attr('cx'))
                            .attr('y1', d3.select(this).attr('cy'))
                            .attr('x2', d3.select(this).attr('cx'))
                            .attr('y2', graphTop)
                            .style('stroke', d3.select(this).style('fill'))
                        d3.select("svg")
                            .append('line')
                            .attr('class', 'hover-line _temp')
                            .attr('x1', pad)
                            .attr('y1', d3.select(this).attr('cy'))
                            .attr('x2', d3.select(this).attr('cx'))
                            .attr('y2', d3.select(this).attr('cy'))
                            .style('stroke', d3.select(this).style('fill'))
                        d3.select("svg")
                            .append('text')
                            .attr('class', 'country _temp')
                            .html(d3.select(this).datum().countryNameDifference)
                            .attr('x', d3.select(this).attr('cx'))
                            .attr('y', d3.select(this).attr('cy'))
                            .attr("dx", 10)
                            .attr("dy", 6)
                            .style('fill', '111111')
                            .attr('text-anchor', 'start')
                            .attr('visibility', 'visible')
                    })
                    .on('mouseout', function() {
                        d3.selectAll('._temp')
                            .attr('visibility', 'hidden');
                    })
                    .on('click', function(e, d) {
                        d3.select("svg")
                        var countryData = [{ value: +e._2011_2015, year: 2015}, { value: +e._2006_2010, year: 2010 }, { value: +e._2001_2005, year: 2005 },
                            { value: +e._1996_2000, year: 2000 }, { value: +e._1991_1995, year: 1995 }, { value: +e._1986_1990, year: 1990 },
                            { value: +e._1981_1985, year: 1985 },  { value: +e._1976_1980, year: 1980 }
                        ];
                        if (e.africa == "yes") {var color = "orange" }
                        else {var color = "#777777" }

                        let modalTitle = d3.selectAll("h3.modal-title");
                        modalTitle.text(e.countryName);
                        let modalBody = d3.selectAll(".modal-body");
                        modalBody.html("<div id='countryPlot'></div>")

                        var pad = 72;
                        var w = 500;
                        var h = 500;
                        var graphTop = h - pad;
                        var radius = 7;
                        var minGini = 0;
                        var maxGini = 80;
                        var vlowToLow = 39.95
                        var lowToMed = 44.95
                        var medToHigh = 52.95
                        var highToVhigh = 59.95

                        var svg = d3.select("#countryPlot")
                            .append("svg")
                            .attr("height", h)
                            .attr("width", w);

                        var xScale = d3.scaleLinear()
                            .domain([1980, 2015])
                            .range([pad + 50, w - pad]);

                        var yScale = d3.scaleLinear()
                            .domain([minGini, maxGini])
                            .range([h - pad, pad]);

                        var xAxisTickLabels = ["1976–1980", "1981–1985", "1986–1990", "1991–1995", "1996–2000", "2001–2005", "2006–2010", "2011–2015"]
                        var xAxis = d3.axisBottom(xScale).ticks(8).tickValues(d.year).tickFormat(function(d, i) { return xAxisTickLabels[i] });
                        var yAxis = d3.axisLeft(yScale).ticks(8);

                        function make_y_gridlines() {
                            return d3.axisLeft(yScale)
                                .ticks(8)
                        }

                        svg.append("rect")
                            .attr("x", pad)
                            .attr("y", h - pad - ((vlowToLow - minGini) / (maxGini - minGini)) * (h - 2 * pad))
                            .attr("width", 10)
                            .attr("height", ((vlowToLow - minGini) / (maxGini - minGini)) * (h - 2 * pad))
                            .style("fill", "4c9f38")
                            .style("opacity", 0.6);

                        svg.append("rect")
                            .attr("x", pad)
                            .attr("y", h - pad - ((lowToMed - minGini) / (maxGini - minGini)) * (h - 2 * pad))
                            .attr("width", 10)
                            .attr("height", ((lowToMed - vlowToLow) / (maxGini - minGini)) * (h - 2 * pad))
                            .style("fill", "002D62")
                            .style("opacity", 0.6);

                        svg.append("rect")
                            .attr("x", pad)
                            .attr("y", h - pad - ((medToHigh - minGini) / (maxGini - minGini)) * (h - 2 * pad))
                            .attr("width", 10)
                            .attr("height", ((medToHigh - lowToMed) / (maxGini - minGini)) * (h - 2 * pad))
                            .style("fill", "87499C")
                            .style("opacity", 0.6);

                        svg.append("rect")
                            .attr("x", pad)
                            .attr("y", h - pad - ((highToVhigh - minGini) / (maxGini - minGini)) * (h - 2 * pad))
                            .attr("width", 10)
                            .attr("height", ((highToVhigh - medToHigh) / (maxGini - minGini)) * (h - 2 * pad))
                            .style("fill", "#dda63a")
                            .style("opacity", 0.6);

                        svg.append("rect")
                            .attr("x", pad)
                            .attr("y", h - pad - ((maxGini - minGini) / (maxGini - minGini)) * (h - 2 * pad))
                            .attr("width", 10)
                            .attr("height", ((maxGini - highToVhigh) / (maxGini - minGini)) * (h - 2 * pad))
                            .style("fill", "#e5243b")
                            .style("opacity", 0.6);

                        svg.append("g")
                            .attr("class", "x-axis")
                            .attr("transform", "translate(0," + (h - pad) + ")")
                            .call(xAxis)
                            .selectAll("text")
                            .style("text-anchor", "end")
                            .attr("transform", 'translate(-7, 1) rotate(-45)')
                            .attr('text-anchor', 'start');

                        d3.select('.x-axis')
                            .append('text')
                            .attr("class", "axis-title")
                            .attr("transform", "translate(" + ((w/2) - 40) + ", 68)")
                            .attr('text-anchor', 'start')
                            .text("5-Year period");

                        svg.append("g")
                            .attr("class", "y-axis")
                            .attr("transform", "translate(" + pad + ", 0)")
                            .call(yAxis)
                            .selectAll("text")
                            .style("text-anchor", "end")

                        d3.select('.y-axis')
                            .append('text')
                            .attr("class", "axis-title")
                            .attr("transform", "translate(-35, 115) rotate(-90)")
                            .text("Income inequality (Gini coefficient)");

                        svg.append("g")
                            .attr("class", "grid")
                            .attr("transform", "translate(" + pad + ",0)")
                            .call(make_y_gridlines()
                                .tickSize(-w + 2 * pad)
                                .tickFormat("")
                            )

                        var circ = svg.selectAll("circle")
                            .data(countryData)
                            .enter()
                            .append("circle")
                            .attr("class", "dot")
                            .attr("cx", function(d) { return xScale(d.year); })
                            .attr("cy", function(d) { return yScale(d.value); })
                            .attr("r", radius)
                            .attr("opacity", 0.8)
                            .style("fill", color)
                        
                        d3.selectAll('.dot')
                            .on('mouseover', function() {
                                d3.select("svg")
                                    .append('line')
                                    .attr('class', 'hover-line _temp')
                                    .attr('x1', d3.select(this).attr('cx'))
                                    .attr('y1', d3.select(this).attr('cy'))
                                    .attr('x2', d3.select(this).attr('cx'))
                                    .attr('y2', graphTop)
                                    .style('stroke', d3.select(this).style('fill'))
                                d3.select("svg")
                                    .append('line')
                                    .attr('class', 'hover-line _temp')
                                    .attr('x1', pad)
                                    .attr('y1', d3.select(this).attr('cy'))
                                    .attr('x2', d3.select(this).attr('cx'))
                                    .attr('y2', d3.select(this).attr('cy'))
                                    .style('stroke', d3.select(this).style('fill'))
                                d3.select("svg")
                                    .append('text')
                                    .attr('class', 'score _temp')
                                    .html(d3.select(this).datum().value)
                                    .attr('x', d3.select(this).attr('cx'))
                                    .attr('y', d3.select(this).attr('cy'))
                                    .attr("dy", -13)
                                    .style('color', '#333333')
                                    .attr('text-anchor', 'middle')
                                    .attr('visibility', 'visible')
                            })
                            .on('mouseout', function() {
                                d3.selectAll('._temp')
                                    .attr('visibility', 'hidden');
                            })
                    });
                }

            var svg = d3.select("body")
                .append("svg")
                .attr("width", 1100)
                .attr("height", 720)

            var circle = svg.append("circle")
                .attr("cx", 940)
                .attr("cy", 485)
                .attr("r", radius)
                .style("fill", "orange")
                .style("opacity", 0.8)

            var circle = svg.append("circle")
                .attr("cx", 940)
                .attr("cy", 505)
                .attr("r", radius)
                .style("fill", "777777")
                .style("opacity", 0.8)

            var text = svg.append("text")
                .attr("class", "keyTitle")
                .attr("x", "930")
                .attr("y", "468")
                .text("Countries");

            var text = svg.append("text")
                .attr("class", "key")
                .attr("x", "955")
                .attr("y", "490")
                .text("in Africa");

            var text = svg.append("text")
                .attr("class", "key")
                .attr("x", "955")
                .attr("y", "510")
                .text("rest of world");

            var rect = svg.append("polygon")
                .attr("points", "915 585, 940 560, 948 568, 923 593")
                .style("fill", "e5243b")
                .style("opacity", 0.6);

            var rect = svg.append("polygon")
                .attr("points", "915 610, 940 585, 948 593, 923 618")
                .style("fill", "dda63a")
                .style("opacity", 0.6);

            var rect = svg.append("polygon")
                .attr("points", "915 635, 940 610, 948 618, 923 643")
                .style("fill", "87499C")
                .style("opacity", 0.6);

            var rect = svg.append("polygon")
                .attr("points", "915 660, 940 635, 948 643, 923 668")
                .style("fill", "002D62")
                .style("opacity", 0.6);

            var rect = svg.append("polygon")
                .attr("points", "915 685, 940 660, 948 668, 923 693")
                .style("fill", "4c9f38")
                .style("opacity", 0.6);

            var text = svg.append("text")
                .attr("class", "keyTitle")
                .attr("x", "930")
                .attr("y", "548")
                .text("Gini ranges on axes");

            var text = svg.append("text")
                .attr("class", "key")
                .attr("x", "955")
                .attr("y", "570")
                .text(">60 (very high)");

            var text = svg.append("text")
                .attr("class", "key")
                .attr("x", "955")
                .attr("y", "595")
                .text(" 53–59.9 (high)");

            var text = svg.append("text")
                .attr("class", "key")
                .attr("x", "955")
                .attr("y", "620")
                .text(" 45–52.9 (medium)");

            var text = svg.append("text")
                .attr("class", "key")
                .attr("x", "955")
                .attr("y", "645")
                .text(" 40–44.9 (low)");

            var text = svg.append("text")
                .attr("class", "key")
                .attr("x", "955")
                .attr("y", "670")
                .text("<39.9 (very low)");
        }

    </script>

    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>

</body>

</html>
